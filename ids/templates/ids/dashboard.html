<!-- ids/templates/ids/dashboard.html -->
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>IDS Dashboard</title>
    {% load static %}
    <link rel="stylesheet" href="{% static 'ids/css/styles.css' %}">
</head>
<body>
    <!-- Sidebar Navigation -->
    <div class="sidebar">
        <h2>Kiberhujumni aniqlash tizimi</h2>
        <a href="{% url 'dashboard' %}" class="active">Bosh menu</a>
        <a href="{% url 'flows' %}">Oqimlar</a>
        <a href="{% url 'analysis' %}">Analiz qilish</a>
        <a href="{% url 'alerts' %}">Ogohlantirishlar</a>
        <a href="{% url 'rules' %}">Qoidalar</a>
    </div>

    <!-- Main Content -->
    <div class="main-content">
        <header>
            <h1>Dashboard</h1>
        </header>

        <!-- Statistics Overview -->
        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px; margin-bottom: 20px;">
            <div style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; padding: 20px; border-radius: 10px; text-align: center;">
                <h3 style="margin: 0; font-size: 2em;">{{ total_alerts }}</h3>
                <p style="margin: 5px 0 0 0;">Jami ogohlantirishlar</p>
            </div>
            <div style="background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%); color: white; padding: 20px; border-radius: 10px; text-align: center;">
                <h3 style="margin: 0; font-size: 2em;">{{ open_alerts }}</h3>
                <p style="margin: 5px 0 0 0;">Ochiq ogohlantirishlar</p>
            </div>
            <div style="background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%); color: white; padding: 20px; border-radius: 10px; text-align: center;">
                <h3 style="margin: 0; font-size: 2em;">{{ critical_alerts }}</h3>
                <p style="margin: 5px 0 0 0;">Kritik ogohlantirishlar</p>
            </div>
            <div style="background: linear-gradient(135deg, #43e97b 0%, #38f9d7 100%); color: white; padding: 20px; border-radius: 10px; text-align: center;">
                <h3 style="margin: 0; font-size: 2em;">{{ benign_count }}/{{ benign_count|add:malicious_count }}</h3>
                <p style="margin: 5px 0 0 0;">Xavfsiz / Jami</p>
            </div>
        </div>

        <!-- Recent Alerts -->
        {% if recent_alerts %}
        <div class="card" style="margin-bottom: 20px;">
            <h3>So'nggi ogohlantirishlar</h3>
            <div style="max-height: 200px; overflow-y: auto;">
                {% for alert in recent_alerts %}
                    <div style="border-left: 4px solid {% if alert.severity == 'critical' %}#dc3545{% elif alert.severity == 'high' %}#fd7e14{% elif alert.severity == 'medium' %}#ffc107{% else %}#28a745{% endif %}; padding: 10px; margin-bottom: 10px; background-color: {% if alert.severity == 'critical' %}#f8d7da{% elif alert.severity == 'high' %}#ffeaa7{% elif alert.severity == 'medium' %}#fff3cd{% else %}#d4edda{% endif %};">
                        <div style="display: flex; justify-content: space-between; align-items: center;">
                            <div>
                                <strong>{{ alert.title }}</strong>
                                <div style="font-size: 0.9em; color: #666;">{{ alert.attack_type|default:"Noma'lum" }} - {{ alert.created_at|timesince }} oldin</div>
                            </div>
                            <span style="background-color: {% if alert.severity == 'critical' %}#dc3545{% elif alert.severity == 'high' %}#fd7e14{% elif alert.severity == 'medium' %}#ffc107{% else %}#28a745{% endif %}; color: white; padding: 3px 8px; border-radius: 12px; font-size: 12px;">
                                {{ alert.get_severity_display }}
                            </span>
                        </div>
                    </div>
                {% endfor %}
            </div>
            <div style="text-align: center; margin-top: 15px;">
                <a href="{% url 'alerts' %}" style="background-color: #007bff; color: white; padding: 8px 16px; text-decoration: none; border-radius: 4px;">Barcha ogohlantirishlarni ko'rish</a>
            </div>
        </div>
        {% endif %}

        <!-- Attack Distribution -->
        {% if attack_distribution %}
        <div class="card" style="margin-bottom: 20px;">
            <h3>So'nggi 24 soatdagi hujum turlari</h3>
            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 10px;">
                {% for attack in attack_distribution %}
                    <div style="text-align: center; padding: 15px; background-color: #f8f9fa; border-radius: 5px;">
                        <div style="font-size: 1.5em; font-weight: bold; color: #333;">{{ attack.count }}</div>
                        <div style="font-size: 0.9em; color: #666;">{{ attack.attack_type|default:"Noma'lum" }}</div>
                    </div>
                {% endfor %}
            </div>
        </div>
        {% endif %}

        <div class="card">
            <h3>Recent Network Flows</h3>
            <table>
                <thead>
                    <tr>
                        <th>Timestamp</th>
                        <th>Protocol</th>
                        <th>Flow Duration</th>
                        <th>Total Fwd Packets</th>
                        <th>Prediction</th>
                    </tr>
                </thead>
                <tbody id="flows-body">
                    {% for flow in flows %}
                    <tr>
                        <td>{{ flow.timestamp }}</td>
                        <td>{{ flow.protocol }}</td>
                        <td>{{ flow.flow_duration }}</td>
                        <td>{{ flow.total_fwd_packets }}</td>
                        <td>{{ flow.prediction }}</td>
                    </tr>
                    {% empty %}
                    <tr>
                        <td colspan="5">No recent flows available.</td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </div>

    <script src="{% static 'ids/js/dashboard.js' %}?v=1.1"></script>
</body>
</html>